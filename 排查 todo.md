# "想法胶囊" 应用调试清单 (Debug TODO List)

**目标：** 通过系统化的步骤，从后端到前端，彻底解决应用无法正常工作的问题。

完成一项，就在复选框中打上一个 `x` (`- [x]`)。

---

## 阶段一：确保后端服务稳定运行 (核心问题)

**目标：** 让 `server` 目录下的 Node.js 服务能成功启动，并稳定连接到 MongoDB Atlas 数据库。这是所有后续步骤的前提。

*   [ ] **1.1: 终极确认数据库连接字符串 (`MONGODB_URI`)**
    *   [ ] **操作：** 打开 `server/.env` 文件。
    *   [ ] **检查1：** 确认 `MONGODB_URI` 的值是**从 Atlas 网站上完整复制**的、最新的连接字符串。
    *   [ ] **检查2：** 确认字符串中的 `<password>` 部分，已经被替换为**不含任何特殊字符 (`@`, `:`, `/`, `?` 等) 的真实密码**。
    *   [ ] **检查3 (可选但推荐):** 如果不确定，请在 Atlas 网站上为数据库用户**重新设置一个只包含字母和数字的简单密码**，然后用这个新密码生成全新的连接字符串，替换掉 `.env` 文件里的旧内容。

*   [ ] **1.2: 验证后端服务能独立运行**
    *   [ ] **操作：** 在 `server` 目录下，运行 `npm run dev`。
    *   [ ] **检查：** 观察终端输出，**必须看到 `Server is running on port 5001` 和 `MongoDB connected` 两条成功信息**。在看到这两条信息之前，我们不能进行下一步。
    *   [ ] **排错：** 如果仍然看到 `ETIMEOUT` 或其他错误，问题 100% 出在 `MONGODB_URI` 上，请回到 1.1 重新检查。

---

## 阶段二：验证后端 API 功能

**目标：** 在不涉及前端的情况下，直接测试后端 API 接口是否能正常读写数据库。

*   [ ] **2.1: 使用 `curl` 测试 `GET /api/capsules` 接口**
    *   [ ] **操作：** 打开一个**新的**终端窗口，运行以下命令：
        ```bash
        curl http://localhost:5001/api/capsules
        ```
    *   [ ] **检查：** 终端应该返回一个 JSON 数组 `[]` (如果数据库是空的) 或者包含数据的数组。只要不是错误信息，就说明 GET 接口正常。

*   [ ] **2.2: 使用 `curl` 测试 `POST /api/capsules` 接口**
    *   [ ] **操作：** 在同一个新终端窗口，运行以下命令：
        ```bash
        curl -X POST -H "Content-Type: application/json" -d '{"content":"这是一条测试胶囊"}' http://localhost:5001/api/capsules
        ```
    *   [ ] **检查：** 终端应该返回一个包含你刚刚发送内容的 JSON 对象。
    *   [ ] **验证：** 再次运行 GET 命令 (`curl http://localhost:5001/api/capsules`)，应该能看到刚刚添加的 "这是一条测试胶囊"。

---

## 阶段三：验证本地前后端联调

**目标：** 确保在本地开发环境下，前端应用能与后端服务正常通信。

*   [ ] **3.1: 检查前端代理配置**
    *   [ ] **操作：** 打开 `client/package.json` 文件。
    *   [ ] **检查：** 确认文件中包含 `"proxy": "http://localhost:5001",` 这一行。

*   [ ] **3.2: 运行完整本地应用**
    *   [ ] **操作：**
        1.  保持后端服务 (`npm run dev`) 正在运行。
        2.  在 `client` 目录下，运行 `npm start`。
    *   [ ] **检查：** 在浏览器打开的 `http://localhost:3000` 页面中，进行新增和查看操作。所有功能应该都完全正常，浏览器控制台（Console）不应再有 500 或 404 错误。

---

## 阶段四：重新部署到 Vercel

**目标：** 将本地验证通过的、完全正常的代码，重新部署到线上。

*   [ ] **4.1: 提交所有代码修复**
    *   [ ] **操作：** 将所有修改过的文件（`server.js`, `client/package.json`, `vercel.json` 等）提交到 Git。
        ```bash
        git add .
        git commit -m "Fix: Final debug for local and deployment"
        ```

*   [ ] **4.2: 更新 Vercel 上的环境变量**
    *   [ ] **操作：** 登录 Vercel，进入 `idea-capsule` 项目的 `Settings -> Environment Variables`。
    *   [ ] **检查：** 确保 Vercel 上的 `MONGODB_URI` 环境变量的值，与你本地 `server/.env` 文件里**最终验证成功**的那个值**完全一致**。

*   [ ] **4.3: 推送代码并触发重新部署**
    *   [ ] **操作：**
        ```bash
        git push
        ```
    *   [ ] **检查：** Vercel 会自动开始新的部署。等待部署完成。

*   [ ] **4.4: 最终线上验证**
    *   [ ] **操作：** 访问你的 Vercel 网址 `https://idea-capsule-kzmp.vercel.app`。
    *   [ ] **检查：** 所有功能应该和本地完全一致，能够正常使用。 